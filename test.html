<html>
  <head>
    <script src="wavesurfer.js/dist/wavesurfer.min.js"></script>
    <script>
    
      function playbackAdjuster(){
        this.adjustSpeed = function (factor) {
            console.log("Adjusting Speed by " + factor)
            var song = document.getElementById("songs")
            song.playbackRate = factor * song.playbackRate
            console.log("Current playback speed " + song.playbackRate)
        }
        
        this.adjustVolume =function (factor) {
            console.log("Adjusting Volume by " + factor)
            var song = document.getElementById("songs")
            song.volume = factor + song.volume
            console.log("Current playback speed " + song.volume)
        }
            
        this.wavesurfer = Object.create(WaveSurfer);
        this.initEqualizer =  function (){

          this.wavesurfer.init({
              container: document.querySelector('#waveform'),
              waveColor: '#A8DBA8',
              progressColor: '#3B8686'
          });
  
          // Load audio from URL
          this.wavesurfer.load('http://localhost:8000/Downloads/proj/MyoConduct/file.mp3');
          this.wavesurfer.on('ready', function () {
          var EQ = [
              {
                  f: 32,
                  type: 'lowshelf'
              }, {
                  f: 64,
                  type: 'peaking'
              }, {
                  f: 125,
                  type: 'peaking'
              }, {
                  f: 250,
                  type: 'peaking'
              }, {
                  f: 500,
                  type: 'peaking'
              }, {
                  f: 1000,
                  type: 'peaking'
              }, {
                  f: 2000,
                  type: 'peaking'
              }, {
                  f: 4000,
                  type: 'peaking'
              }, {
                  f: 8000,
                  type: 'peaking'
              }, {
                  f: 16000,
                  type: 'highshelf'
              }
          ];
  
          // Create filters
          var filters = EQ.map(function (band) {
              var filter = wavesurfer.backend.ac.createBiquadFilter();
              filter.type = band.type;
              filter.gain.value = 0;
              filter.Q.value = 1;
              filter.frequency.value = band.f;
              return filter;
          });
  
          // Connect filters to wavesurfer
          this.wavesurfer.backend.setFilters(filters);
  
          // Bind filters to vertical range sliders
          var container = document.querySelector('#equalizer');
          filters.forEach(function (filter) {
              var input = document.createElement('input');
              this.wavesurfer.util.extend(input, {
                  type: 'range',
                  min: -40,
                  max: 40,
                  value: 0,
                  title: filter.frequency.value
              });
              input.style.display = 'inline-block';
              input.setAttribute('orient', 'vertical');
              wavesurfer.drawer.style(input, {
                  'webkitAppearance': 'slider-vertical',
                  width: '50px',
                  height: '150px'
              });
              container.appendChild(input);
  
              var onChange = function (e) {
                  filter.gain.value = ~~e.target.value;
              };
  
              input.addEventListener('input', onChange);
              input.addEventListener('change', onChange);
          });
  
          // For debugging
          this.wavesurfer.filters = filters;
          });
        }
      }
      
      window.addEventListener('load', function() {
        pbAdj = new playbackAdjuster();
        document.getElementById("waveform").volume = 0.5
        document.getElementById("slowButton").onclick = function() {pbAdj.adjustSpeed(0.5)};
        document.getElementById("fastButton").onclick = function() {pbAdj.adjustSpeed(1.5)};
        document.getElementById("higherButton").onclick = function() {pbAdj.adjustVolume(0.1)};
        document.getElementById("lowerButton").onclick = function() {pbAdj.adjustVolume(-0.1)};
        pbAdj.initEqualizer();
      });
      
    </script>
  </head>
  <body>
    <div id="waveform">
        <div class="progress progress-striped active" id="progress-bar">
            <div class="progress-bar progress-bar-info"></div>
        </div>

        <!-- Here be the waveform -->
    </div>
  
    <button id = "slowButton">Slow Down</button><br/>
    <button id = "fastButton">Fast Up</button><br/>
    
    <button id = "higherButton">Volume Up</button><br/>
    <button id = "lowerButton">Volume Down</button><br/>
    
    <div id="equalizer">
      <!-- Here be equalizer sliders -->
    </div>
  </body>
</html>